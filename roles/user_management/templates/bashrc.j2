# ~/.bashrc: executed by bash(1) for non-login shells.

# If not running interactively, don't do anything
case $- in
    *i*) ;;
      *) return;;
esac

# History settings
HISTCONTROL={{ environment_variables.HISTCONTROL | default('ignoredups:erasedups') }}
HISTSIZE={{ environment_variables.HISTSIZE | default('10000') }}
HISTFILESIZE={{ environment_variables.HISTFILESIZE | default('20000') }}

# Append to the history file, don't overwrite it
shopt -s histappend

# Check the window size after each command and update LINES and COLUMNS
shopt -s checkwinsize

# Enable programmable completion features
if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi

# Enable color support for ls and grep
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi

# Set environment variables
{% for var, value in environment_variables.items() %}
export {{ var }}="{{ value }}"
{% endfor %}

# Load aliases if file exists
if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# Custom functions
{% for func in bash_functions %}
{{ func }}
{% endfor %}

# Matrix server management shortcuts
alias matrix-logs='sudo journalctl -u matrix-synapse -f'
alias matrix-status='sudo systemctl status matrix-synapse caddy postgresql redis-server'
alias matrix-restart='sudo systemctl restart matrix-synapse'
alias caddy-logs='sudo journalctl -u caddy -f'
alias system-status='sudo systemctl status'

# Welcome message
echo "Welcome to Matrix Server ({{ inventory_hostname }})"
echo "Matrix management commands: matrix-status, matrix-logs, matrix-restart"
echo "System commands available in ~/scripts/"