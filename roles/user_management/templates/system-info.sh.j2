#!/bin/bash
# System information script for {{ admin_username }}

echo "=== Matrix Server System Information ==="
echo

echo "Hostname: $(hostname)"
echo "Date: $(date)"
echo "Uptime: $(uptime)"
echo

echo "=== System Resources ==="
echo "CPU:"
cat /proc/cpuinfo | grep "model name" | head -1 | cut -d: -f2 | xargs
echo "Cores: $(nproc)"
echo

echo "Memory:"
free -h

echo
echo "Disk Usage:"
df -h | grep -E '^/dev/'

echo
echo "=== Network Information ==="
echo "IP Addresses:"
ip addr show | grep "inet " | grep -v "127.0.0.1" | awk '{print $2}' | cut -d/ -f1

echo
echo "Listening Ports:"
sudo netstat -tulpn | grep LISTEN | grep -E ':(80|443|8008|8448|{{ ssh_port | default(2222) }}|5432|6379)\s'

echo
echo "=== Matrix Services Status ==="
for service in matrix-synapse caddy postgresql redis-server; do
    if sudo systemctl is-active --quiet $service; then
        echo "✓ $service: running"
    else
        echo "✗ $service: stopped"
    fi
done

echo
echo "=== Security Status ==="
echo "Firewall Status:"
sudo ufw status | head -5

echo
echo "Failed SSH Attempts (last 10):"
sudo grep "Failed password" /var/log/auth.log 2>/dev/null | tail -5 | cut -d' ' -f1,2,3,9,11 || echo "No failed attempts found"

echo
echo "=== Matrix Information ==="
echo "Matrix Domain: {{ matrix_domain | default('not configured') }}"
echo "Homeserver: {{ matrix_homeserver_name | default('not configured') }}"
echo "SSH Port: {{ ssh_port | default(2222) }}"
echo "Admin User: {{ admin_username }}"